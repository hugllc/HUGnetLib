<?php
// Call unitConversionTest::main() if this source file is executed directly.
if (!defined("PHPUnit_MAIN_METHOD")) {
    define("PHPUnit_MAIN_METHOD", "unitConversionTest::main");
}

require_once "PHPUnit/Framework/TestCase.php";
require_once "PHPUnit/Framework/TestSuite.php";

require_once '../unitConversion.php';

/**
 * Test class for unitConversion.
 * Generated by PHPUnit_Util_Skeleton on 2007-10-29 at 16:23:13.
 */
class unitConversionTest extends PHPUnit_Framework_TestCase {
    /**
     * Runs the test methods of this class.
     *
     * @access public
     * @static
     */
    public static function main() {
        require_once "PHPUnit/TextUI/TestRunner.php";

        $suite  = new PHPUnit_Framework_TestSuite("unitConversionTest");
        $result = PHPUnit_TextUI_TestRunner::run($suite);
    }

    /**
     * Sets up the fixture, for example, open a network connection.
     * This method is called before a test is executed.
     *
     * @access protected
     */
    protected function setUp() {
    }

    /**
     * Tears down the fixture, for example, close a network connection.
     * This method is called after a test is executed.
     *
     * @access protected
     */
    protected function tearDown() {
    }

    public function testUnitArray() {
        $o = new unitConversion;
        foreach($o->units as $catName => $cat) {
            foreach($cat as $shortName => $unit) {
                $this->assertTrue(is_string($unit['longName']), $catName.":".$shortName.": Long name is not a string");
                $this->assertThat(strlen($unit['longName']), $this->greaterThan(0), $catName.":".$shortName.": Long name is not a set");            
                $this->assertTrue(is_string($unit['varType']), $catName.":".$shortName.": Variable type is not a string");
                $this->assertTrue($this->checkvarType($unit['varType']), $catName.":".$shortName.": Variable type '".$unit['varType']."'is not valid");
            }
        }
    }

    private function checkvarType($vartype) {
        if ($vartype == 'float') return TRUE;
        if ($vartype == 'int') return TRUE;
        if ($vartype == 'text') return TRUE;
        return FALSE;
    }
    /**
     */
    public function testpreferredUnit() {
        $o = new unitConversion;
        $this->assertEquals("&#176;F", $o->preferredUnit("&#176;C"));
        $this->assertEquals("&#176;F", $o->preferredUnit("&#176;F"));
    }    
    
    /**
     */
    public function testgraphable() {
        $o = new unitConversion;
        $this->assertEquals(TRUE, $o->graphable("&#176;C"));
        $this->assertEquals(FALSE, $o->graphable("Direction"));
    }    
    /**
     */
    public function testfindUnit() {
        $o = new unitConversion;
        $this->assertEquals(TRUE, is_array($o->findUnit("&#176;C")));
        $this->assertEquals(FALSE, $o->findUnit("ASDF"));

/*
        foreach($this->units as $key => $value) {
            if (isset($value[$unit])) return $this->units[$key][$unit];
        }
        return FALSE;
*/
    }

    /**
     */
    public function testgetDataType() {
        $o = new unitConversion;
        $this->assertEquals("asdf", $o->getDataType("&#176;C", "", "asdf"));
        $this->assertEquals("raw", $o->getDataType("Direction", "", "asdf"));
    }

    /**
     * Gets the conversion function to convert $from to $to
     *
     * @param string $from The starting unit
     * @param string $to The unit to be converted into
     * @param string $type The data type to use
     * @return string NULL if no function exists, the function name otherwise. 
     */
    public function testgetConvFunct() {
        $o = new unitConversion;
        $this->assertEquals("FtoC", $o->getConvFunct("&#176;F", "&#176;C", "diff"));
        $this->assertEquals(NULL, $o->getConvFunct("&#176;F", "Direction", "diff"));
    }
    /**
     */

    public function testgetPossConv() {
        $o = new unitConversion;
        $this->assertEquals(TRUE, is_array($o->getPossConv("diff")));
        $this->assertEquals(TRUE, is_array($o->getPossConv("diff", "&#176;F")));
        $this->assertEquals(array("asdf" => "asdf"), $o->getPossConv("diff", "asdf"));
    }

    /**
     */
    public function testCtoF() {
        $o = new unitConversion;
        $this->assertEquals(212, $o->CtoF(100, 0, "raw"));        
        $this->assertEquals(32, $o->CtoF(0, 0, "raw"));        
        $this->assertEquals(-40, $o->CtoF(-40, 0, "raw"));        
        $this->assertEquals(180, $o->CtoF(100, 0, "diff"));        
        $this->assertEquals(0, $o->CtoF(0, 0, "diff"));        
	}

    /**
     *  Converts from &#176; F to &#176; C.
     *
     *  If the temperature is differential we can't subtract 32 like we would
     *  for an absolute temperature.  This is because it is already factored
     *  out by the subtraction in the difference.
     *
     * @param float $f The temperature in F
     * @param int $time The time in seconds between this record and the last.
     * @param string $type The type of data (diff, raw, etc)
     * @return float The temperature in C
    */
	public function testFtoC() {
        $o = new unitConversion;
        $this->assertEquals(100, $o->FtoC(212, 0, "raw"));        
        $this->assertEquals(0, $o->FtoC(32, 0, "raw"));        
        $this->assertEquals(-40, $o->FtoC(-40, 0, "raw"));        
        $this->assertEquals(100, $o->FtoC(180, 0, "diff"));        
        $this->assertEquals(0, $o->FtoC(0, 0, "diff"));        
	}


    /**
    */
	public function testtoMilli() {
        $o = new unitConversion;
        $this->assertEquals(0, $o->toMilli(0, 0, 'raw'));
        $this->assertEquals(1000, $o->toMilli(1, 0, 'diff'));
	}
    /**
     *
    */
	public function testfromMilli() {
        $o = new unitConversion;
        $this->assertEquals(0, $o->fromMilli(0, 0, 'raw'));
        $this->assertEquals(1, $o->fromMilli(1000, 0, 'diff'));
	}

    /**
    */
	public function testfromCenti() {
        $o = new unitConversion;
        $this->assertEquals(0, $o->fromCenti(0, 0, 'raw'));
        $this->assertEquals(1, $o->fromCenti(100, 0, 'diff'));
	}

    /**
     */
    public function testCnttoRPM() {
        $o = new unitConversion;
        $this->assertEquals(NULL, $o->CnttoRPM(0, 0, 'raw', 0));
        $this->assertEquals(50, $o->CnttoRPM(50, 60, 'diff', 1));
        $this->assertEquals(50, $o->CnttoRPM(50, 60, 'diff', 0));
    }

    /**
     */
    public function testDirtonumDir() {
        $o = new unitConversion;
        $this->assertEquals(0, $o->DirtonumDir("N", 0, 0));
        $this->assertEquals(22.5, $o->DirtonumDir("NNE", 0, 0));
        $this->assertEquals(45, $o->DirtonumDir("NE", 0, 0));
        $this->assertEquals(67.5, $o->DirtonumDir("ENE", 0, 0));
        $this->assertEquals(90, $o->DirtonumDir("E", 0, 0));
        $this->assertEquals(112.5, $o->DirtonumDir("ESE", 0, 0));
        $this->assertEquals(135, $o->DirtonumDir("SE", 0, 0));
        $this->assertEquals(157.5, $o->DirtonumDir("SSE", 0, 0));
        $this->assertEquals(180, $o->DirtonumDir("S", 0, 0));
        $this->assertEquals(202.5, $o->DirtonumDir("SSW", 0, 0));
        $this->assertEquals(225, $o->DirtonumDir("SW", 0, 0));
        $this->assertEquals(247.5, $o->DirtonumDir("WSW", 0, 0));
        $this->assertEquals(270, $o->DirtonumDir("W", 0, 0));
        $this->assertEquals(292.5, $o->DirtonumDir("WNW", 0, 0));
        $this->assertEquals(315, $o->DirtonumDir("NW", 0, 0));
        $this->assertEquals(337.5, $o->DirtonumDir("NNW", 0, 0));
        $this->assertEquals(0, $o->DirtonumDir("ASDF", 0, 0));
    }

    /**
     */
    public function testnumDirtoDir() {
        $o = new unitConversion;
        $this->assertEquals("N", $o->numDirtoDir(0, 0, 0));
        $this->assertEquals("NNE", $o->numDirtoDir(22.5, 0, 0));
        $this->assertEquals("NE", $o->numDirtoDir(45, 0, 0));
        $this->assertEquals("ENE", $o->numDirtoDir(67.5, 0, 0));
        $this->assertEquals("E", $o->numDirtoDir(90, 0, 0));
        $this->assertEquals("ESE", $o->numDirtoDir(112.5, 0, 0));
        $this->assertEquals("SE", $o->numDirtoDir(135, 0, 0));
        $this->assertEquals("SSE", $o->numDirtoDir(157.5, 0, 0));
        $this->assertEquals("S", $o->numDirtoDir(180, 0, 0));
        $this->assertEquals("SSW", $o->numDirtoDir(202.5, 0, 0));
        $this->assertEquals("SW", $o->numDirtoDir(225, 0, 0));
        $this->assertEquals("WSW", $o->numDirtoDir(247.5, 0, 0));
        $this->assertEquals("W", $o->numDirtoDir(270, 0, 0));
        $this->assertEquals("WNW", $o->numDirtoDir(292.5, 0, 0));
        $this->assertEquals("NW", $o->numDirtoDir(315, 0, 0));
        $this->assertEquals("NNW", $o->numDirtoDir(337.5, 0, 0));
        $this->assertEquals("N", $o->numDirtoDir(360, 0, 0));
        $this->assertEquals("N", $o->numDirtoDir(-1, 0, 0));
    }
    
    /**
     */
    public function testkWhTokW () {
        $o = new unitConversion;
        $this->assertEquals(NULL, $o->kWhTokW(100, 0, 'diff', 0));
        $this->assertEquals(NULL, $o->kWhTokW(100, 0, 'raw', 0));
        $this->assertEquals(10, $o->kWhTokW(1, 360, 'diff', 0));
        $this->assertEquals(10, $o->kWhTokW(1, -360, 'diff', 0));
    }

    /**
     */
    public function testkWhToW () {
        $o = new unitConversion;
        $this->assertEquals(NULL, $o->kWhToW(100, 0, 'diff', 0));
        $this->assertEquals(NULL, $o->kWhToW(100, 0, 'raw', 0));
        $this->assertEquals(10000, $o->kWhToW(1, 360, 'diff', 0));
        $this->assertEquals(10000, $o->kWhToW(1, -360, 'diff', 0));
    }

}

// Call unitConversionTest::main() if this source file is executed directly.
if (PHPUnit_MAIN_METHOD == "unitConversionTest::main") {
    unitConversionTest::main();
}
?>
