<?xml version="1.0" encoding="UTF-8"?>
<!-- Generated by PHP Project Wizard (PPW) 1.0.4 on Mon Oct 3 15:21:39 CDT 2011 -->

<project name="deb" default="build" basedir=".">
    <property name="setup" value="${basedir}/deb"/>
    <property name="source" value="${basedir}/src"/>
    <property name="staging" value="${basedir}/build/deb"/>
    <property name="release" value="" />
    <property name="versionfile" value="${basedir}/src/VERSION.TXT" />
    <exec executable="grep" failonerror="true"
        outputproperty="version" errorproperty="versionerror">
        <arg line='-o -e "[0-9]\{1,\}\.[0-9]\{1,\}\.[0-9]\{1,\}" ${versionfile}'
            />
    </exec>
    <property name="builddir" value="${basedir}/build/rel/" />

    <target name="clean" description="Clean up and create artifact directories">
        <delete dir="${staging}" failonerror="false"/>
        <delete failonerror="false">
            <fileset dir="${builddir}" includes="*.deb"/>
        </delete>
    </target>

    <target name="setup" description="Copy all of the files to build the deb">
        <echo>Setting up for HUGnetLib 'v${version}'</echo>

        <mkdir dir="${staging}"/>
        <copy todir="${staging}">
            <fileset dir="${setup}"/>
        </copy>
        <mkdir dir="${staging}/usr/share/php/HUGnetLib"/>
        <copy todir="${staging}/usr/share/php/HUGnetLib">
            <fileset dir="${source}"/>
        </copy>
        <chmod file="${staging}/DEBIAN/postinst" perm="ugo+rx"/>
        <chmod file="${staging}/DEBIAN/prerm" perm="ugo+rx"/>
        <replaceregexp file="${staging}/DEBIAN/control"
                    match="%VERSION%"
                    replace="${version}"
        />
    </target>
    <target name="deb" description="build the deb">
        <mkdir dir="${builddir}"/>
        <exec executable="dpkg" failonerror="true">
            <arg line="-b ${staging}
                       ${builddir}/HUGnetLib_${version}${release}_all.deb"/>
        </exec>
    </target>
    <target name="postclean" description="build the deb">
        <delete dir="${staging}"/>
    </target>
    <target name="build" depends="clean,setup,deb,postclean"/>

</project>
